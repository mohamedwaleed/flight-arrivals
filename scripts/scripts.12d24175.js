"use strict";function CsvModel(a){function b(a){for(var b={},c=a.split("\n"),d=1;d<c.length;d++){var e=c[d];if(e){var f=e.split(","),g=f[1].trim().substring(1,f[1].trim().length-1),h=f[2].trim().substring(1,f[2].trim().length-1),i=f[3].trim().substring(1,3)+":"+f[3].trim().substring(3,f[3].trim().length-1),j=f[4].trim().substring(1,3)+":"+f[4].trim().substring(3,f[4].trim().length-1);""===f[5]&&(f[5]="0.0");var k={date:f[0],origin:g,dest:h,departureTime:i,arrivalTime:j,arrivalDelay:parseFloat(f[5]),elapsedTime:parseFloat(f[6]),distance:parseFloat(f[7])};void 0===b[k.origin]?b[k.origin]=[k]:b[k.origin].push(k)}}return b}this.data=null;var c=this;c.readCsvFile=function(){var d=a.getFlights(),e=function(a){c.data=b(a.data)},f=function(){console.log("fail")};return d.then(e,f)},c.searchFlights=function(a,b){return c.data[a]?c.data[a].filter(function(a){return a.dest===b}):[]},c.getFlightsAsArray=function(){if(!c.data)return[];for(var a=[],b=Object.keys(c.data),d=0;d<b.length;d++)a=a.concat(c.data[b[d]]);return a}}angular.module("flightArrivalApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","chart.js","ui.router","ngMaterial","htmlToPdfSave"]),angular.module("flightArrivalApp").config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("app",{"abstract":!0,url:"/",templateUrl:"views/main.html"}).state("app.dashboard",{url:"dashboard",templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}).state("app.analytics",{url:"analytics",templateUrl:"views/analytics.html",controller:"AnalyticsCtrl",params:{origin:null,dest:null}}),b.otherwise("/dashboard")}]),angular.module("flightArrivalApp").constant("BASE_URL",""),angular.module("flightArrivalApp").run(["CsvModel","$rootScope","$mdToast",function(a,b,c){b.ready=!1,b.showSimpleToast=function(a,b){b||(b=3e3);var d={bottom:!1,top:!0,left:!1,right:!0};c.show(c.simple().textContent(a).position(d).hideDelay(b))},a.readCsvFile().then(function(){b.ready=!0},function(a){console.log(a)})}]),angular.module("flightArrivalApp").controller("MainCtrl",["$scope","$interval",function(a,b){}]),angular.module("flightArrivalApp").controller("DashboardCtrl",["$scope","CsvModel","$state","$mdToast",function(a,b,c,d){a.origin="",a.dest="",a.searchFlights=function(){c.go("app.analytics",{origin:a.origin,dest:a.dest})}}]),angular.module("flightArrivalApp").controller("AnalyticsCtrl",["$scope","CsvModel","$stateParams","$state","$rootScope","$mdToast",function(a,b,c,d,e,f){function g(a){for(var b=0,c=0;c<a.length;c++){var d=a[c].arrivalDelay/a[c].elapsedTime*100;b+=d/a.length}return b}return a.origin=c.origin,a.dest=c.dest,e.ready&&a.origin&&a.dest?(a.flights=b.searchFlights(a.origin,a.dest),0===a.flights.length?(f.show(f.simple().textContent("No avalible flight for given origin and destination").position("top right")),void d.go("app.dashboard")):(a.overallDelayRatio=g(a.flights).toFixed(2),void(a.allFlights=b.getFlightsAsArray()))):(f.show(f.simple().textContent("Input is empty").position("top right")),void d.go("app.dashboard"))}]),angular.module("flightArrivalApp").controller("FlightDelaysController",["$scope","CsvModel","$stateParams","$state","$rootScope",function(a,b,c,d,e){var f=a.flights;f&&(a.fullData=f.map(function(a){return a.arrivalDelay}),a.data=[a.fullData],a.labels=f.map(function(a){return a.date}),a.options={title:{display:!0,text:"Flight delays",fontSize:30},legend:{display:!0},tooltips:{enabled:!0,callbacks:{label:function(a,b){var c=f[a.index].departureTime,d=f[a.index].arrivalTime,e=b.datasets[0].data[a.index]+" Miniuts , Departure time: "+c+", Arrival time: "+d;return e}}}},a.datasetOverride=[{label:"Flight delay (in miniuts)",borderWidth:1,borderColor:"#45b7cd",pointHighlightStroke:"#FF00AA",hoverBackgroundColor:"rgba(255,99,132,0.4)",hoverBorderColor:"rgba(255,99,132,1)",type:"bar"}])}]),angular.module("flightArrivalApp").controller("FlightDelayRatiosController",["$scope","CsvModel","$stateParams","$state","$rootScope",function(a,b,c,d,e){var f=a.flights;f&&(a.fullData=f.map(function(a){var b=Math.ceil(a.arrivalDelay/a.elapsedTime*100);return b}),a.data=[a.fullData],a.labels=f.map(function(a){return a.date}),a.options={title:{display:!0,text:"Flight delay ratios",fontSize:30},legend:{display:!0},tooltips:{enabled:!0,callbacks:{label:function(a,b){var c=f[a.index].departureTime,d=f[a.index].arrivalTime,e=b.datasets[0].data[a.index],g=(e>=0?e:-1*e)+"% "+(e>=0?"delay arrival":"early arrival")+" , Departure time: "+c+", Arrival time: "+d;return g}}}},a.datasetOverride=[{label:"Flight delay ratio (in percentage)",borderWidth:1,borderColor:"#45b7cd",pointHighlightStroke:"#FF00AA",hoverBackgroundColor:"rgba(255,99,132,0.4)",hoverBorderColor:"rgba(255,99,132,1)",type:"bar"}])}]),angular.module("flightArrivalApp").controller("DelaysCorrelationController",["$scope","CsvModel","$stateParams","$state","$rootScope",function(a,b,c,d,e){var f=a.flights;if(f){var g={};f.forEach(function(a){g[a.distance]||(g[a.distance]={sum:0,count:0}),g[a.distance].sum+=a.arrivalDelay,g[a.distance].count++}),a.fullData=[];for(var h=Object.keys(g),i=0;i<h.length;i++){var j=h[i],k=g[j].sum/g[j].count;a.fullData.push({x:j,y:k})}a.data=[a.fullData],a.options={title:{display:!0,text:"Correlation between delays and distances",fontSize:30},legend:{display:!0},tooltips:{enabled:!0,callbacks:{label:function(a,b){var c=b.datasets[0].data[a.index].x+" miles and "+b.datasets[0].data[a.index].y+" miniuts avarage delay";return c}}},scales:{xAxes:[{type:"linear",position:"bottom"}]}},a.datasetOverride=[{label:"X axes ( distances in miles ) Y axes ( avarage delays in miniuts)",borderWidth:1,borderColor:"#45b7cd",pointHighlightStroke:"#FF00AA",hoverBackgroundColor:"rgba(255,99,132,0.4)",hoverBorderColor:"rgba(255,99,132,1)",type:"scatter"}]}}]),angular.module("flightArrivalApp").service("CsvService",["$http","BASE_URL",function(a,b){return{getFlights:function(){return a({url:b+"Flight-Delays.csv",method:"GET"})}}}]),angular.module("flightArrivalApp").factory("CsvModel",["CsvService",function(a){return new CsvModel(a)}]),angular.module("flightArrivalApp").directive("flightDelays",function(){return{restrict:"E",scope:{flights:"=flights"},templateUrl:"views/chart.html",controller:"FlightDelaysController"}}),angular.module("flightArrivalApp").directive("flightDelayRatios",function(){return{restrict:"E",scope:{flights:"=flights"},templateUrl:"views/chart.html",controller:"FlightDelayRatiosController"}}),angular.module("flightArrivalApp").directive("delaysCorrelation",function(){return{restrict:"E",scope:{flights:"=flights"},templateUrl:"views/chart.html",controller:"DelaysCorrelationController"}}),angular.module("flightArrivalApp").run(["$templateCache",function(a){a.put("views/analytics.html",'<div class="container"> <div class="row"> <div class="col-md-4"> </div> <div class="col-md-4 center"> <h2>Flights From {{origin}} to {{dest}} <button pdf-save-button="idOne" pdf-name="Flights_From_{{origin}}_to_{{dest}}.pdf" class="btn">Download as pdf</button> </h2> </div> <div class="col-md-4"> </div> </div> <div pdf-save-content="idOne"> <div class="row"> <div class="col-md-3"> </div> <div class="col-md-6 center"> <h3>Overall delay ratio : {{overallDelayRatio}} miniuts</h3> </div> <div class="col-md-3"> </div> </div> <div class="row"> <div class="col-md-12"> <flight-delays flights="flights"></flight-delays> </div> </div> <hr class="divide-line"> <div class="row"> <div class="col-md-12"> <flight-delay-ratios flights="flights"></flight-delay-ratios> </div> </div> <hr class="divide-line"> <div class="row"> <div class="col-md-12"> <delays-correlation flights="allFlights"></delays-correlation> </div> </div> <hr class="divide-line"> </div> </div>'),a.put("views/chart.html",'<div> <canvas id="bar" class="chart chart-bar" chart-data="data" chart-labels="labels" chart-series="series" chart-colors="colors" chart-dataset-override="datasetOverride" chart-options="options"> </canvas> </div>'),a.put("views/dashboard.html",'<div id="slider"> <div id="color_layer"> <div class="input-area"> <h3 id="banner-label">Choose your best flight</h3> <form ng-submit="searchFlights()" class="form-inline center"> <div class="form-group"> <div class="input-group"> <span class="input-group-addon"><span class="glyphicon glyphicon-upload"></span></span> <input ng-model="origin" type="text" class="form-control" placeholder="origin"> </div> </div> <div class="form-group"> <div class="input-group"> <span class="input-group-addon"><span class="glyphicon glyphicon-download"></span></span> <input ng-model="dest" type="text" class="form-control" placeholder="destination"> </div> </div> <button type="submit" class="btn btn-success">Search flights <span class="glyphicon glyphicon-chevron-right"></span></button> </form> </div> </div> </div>'),a.put("views/main.html",'<div ng-show="!ready"> <md-progress-circular class="loading-spinner md-hue-3" md-diameter="70"></md-progress-circular> <h3 class="center">Intialzing app ...</h3> </div> <div ng-show="ready"> <nav class="navbar navbar-default"> <div class="container-fluid"> <div class="navbar-header"> <a class="navbar-brand" href="#"> <img class="logo" alt="Brand" src="images/logo.9f7f571f.png"> </a> <label class="logo-label">Flight arrivals</label> </div> </div> </nav> <div ui-view></div> </div>')}]);